# 家具在庫管理システム (Furniture Inventory Manager)

家具の仕入れから販売、ロケーション履歴までを一括管理する、SQLiteベースの対話型在庫管理システムです。

## 仕様

### 1. データクレンジングとバリデーション
ユーザーの入力ミスをシステム側で吸収し、データベースの健全性を保つための独自関数を実装。
- **全角・半角の自動正規化**: `unicodedata (NFKC)` を用い、全角の英数字、記号（ー、－、／など）を自動で半角に変換。
- **NULL/Noneの厳密な管理**: 空文字や `-`（ハイフン）が入力された場合、DB側には `NULL` として保存。数値項目（Priceなど）も同様の処理を行い、集計時のノイズを排除。
- **柔軟な日付フォーマット**: `20260131` / `2026-01-31` / `2026/01/31` のいずれで入力しても、自動で `YYYY-MM-DD` 形式に統一して保存。

### 2. インテリジェントなマスタ管理 (UPSERT)
- **表記ゆれの自動更新**: `brand_master` 等に `UNIQUE COLLATE NOCASE` と `UPSERT` を採用。`cassina` を `Cassina` と再登録した際、IDを維持したままブランド名を最新の表記に更新。
- **コンテキストに応じた選択肢**: プロダクト選択時、事前に選んだブランドに紐付く製品のみをリストアップ。「プロダクト名（ブランド名）」形式の表示により、同名商品の混同を防止。

### 3. インタラクティブ
- **一括更新フロー**: 1つのアイテムに対して複数の項目を連続で更新し、最後に一括で「変更者」を入力・保存する効率的なワークフロ。
- **既値（デフォルト）の表示**: サイズ（W/D/H/SH）の更新時、現在の値を表示。変更したい箇所だけを打ち直すことが可能。
- **自動ステータス連携**: 商品追加と同時に、タスク(`arrived`)、販売(`preparing`)、ロケーション(`STOCK_ROOM`)を自動生成。

## 📋 主要機能

### 1. 商品登録 (Create)
- 対話型スタイルでの登録。
- ブランド・プロダクトの新規登録、または既存マスタからの選択。

### 2. 一覧表示 (Read)
- 必要な情報だけ抜き出してリスト化
- 作成時に中身を確認できるようにそれぞれのテーブルも一覧表示可能。

### 4. 商品情報更新 (Update)
- アイテムIDを指定し、複数の項目を「一時保存リスト」へ蓄積。
- 保存実行前に、日本語ラベルによる最終確認画面を表示。


### 5. 倫理削除 (Delete)
- 物理的にレコードを削除せず、`is_deleted` フラグを更新することで「システム上は非表示、DB上には現存」する状態を実現。誤って削除しても即座に復旧が可能。
- アイテムID指定後に現在の登録情報（ブランド、プロダクト名等）を再表示。視覚的に「何を消そうとしているか」を確認させた上で、最終的な実行確認を行う。


## 🗄 データベース構造 (SQLite)
- **item**: 在庫本体。ブランド、プロダクト、サイズ・カラー・素材属性を保持。
- **brand_master**: ブランド名のユニーク制約（大文字小文字無視）。
- **product_master**: ブランドIDとプロダクト名の複合ユニーク制約。
- **history系**: ステータスやロケーションの変更履歴を時系列で管理。

